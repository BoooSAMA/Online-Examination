@page "/forgot-password"
@inject NavigationManager Navigation

<PageTitle>Forgot Password | Examination Board</PageTitle>

<HeadContent>
    @* 这里引用原本的 css 即可 *@
    <link rel="stylesheet" href="/css/forgotstyle.css" />
</HeadContent>

<div class="forgot-page">
    <div class="forgot-box">
        <h1>Forgot Password</h1>

        <p class="instruction">
            Enter your registered email address.<br>
            We will send you a verification code.
        </p>

        @if (!string.IsNullOrEmpty(message))
        {
            <div class="alert-message @(isError ? "alert-error" : "alert-success")">
                @message
            </div>
        }

        <div class="form-content">
            <div class="form-group">
                <label>Email Address</label>
                <input type="email"
                       placeholder="Enter your email"
                       @bind="emailAddress"
                       @bind:event="oninput"
                       class="form-control" />
            </div>

            <button class="btn-primary full-width" @onclick="SendCode" disabled="@isProcessing">
                @(isProcessing ? "Sending..." : "Send Verification Code")
            </button>
        </div>

        <p class="back">
            <a href="login">← Back to Login</a>
        </p>
    </div>
</div>

@code {
    private string? emailAddress;
    private string? message;
    private bool isError = false;
    private bool isProcessing = false;

    private async Task SendCode()
    {
        message = null;
        isError = false;
        isProcessing = true;

        if (string.IsNullOrWhiteSpace(emailAddress) || !emailAddress.Contains("@"))
        {
            message = "Please enter a valid email address.";
            isError = true;
            isProcessing = false;
            return;
        }

        // 模拟 API 调用延迟
        await Task.Delay(500);

        // TODO: 在此处调用后端 API 发送邮件逻辑
        // await AuthService.SendEmailAsync(emailAddress);

        isProcessing = false;

        // 发送成功后，跳转到 OTP 页面，并将邮箱作为参数传递
        Navigation.NavigateTo($"/otp-verify?email={emailAddress}");
    }
}